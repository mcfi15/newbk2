$(window).load((function(){let isAuth=window.GLOBAL_VARIABLES.isAuth,baseUrl=window.GLOBAL_VARIABLES.baseUrl,requestUrl=window.GLOBAL_VARIABLES.requestUrl,langUrl=window.GLOBAL_VARIABLES.langUrl,btnSpellingMistake=window.GLOBAL_VARIABLES.btnSpellingMistake,txtEnterErrorContent=window.GLOBAL_VARIABLES.txtEnterErrorContent,txtEnterErrorContentToEdit=window.GLOBAL_VARIABLES.txtEnterContentToEdit;var captchaIsLoad=!1;const captchaSiteKey=window.GLOBAL_VARIABLES.captchaSiteKey,captchaSrc="https://www.google.com/recaptcha/api.js?render="+captchaSiteKey,loadScript=function(scriptUrl){return new Promise((res,rej)=>{const script=document.createElement("script");document.body.appendChild(script),script.onload=function(){res(!0)},script.onerror=function(e){rej(e)},script.src=scriptUrl})},excuteCaptcha=async function(captchaSiteKey){const token=await grecaptcha.execute(captchaSiteKey,{action:"validate_captcha"});return token},submitSpellingMistake=function(token){return new Promise((res,rej)=>{$("#formspellingmistake").prepend('<input type="hidden" name="g-recaptcha-response" value="'+token+'">'),$.ajax({method:"POST",dataType:"json",data:{selectedtextbeforavarible:selectedtextbeforavarible.prop("value"),changetextafteravarible:changetextafteravarible.prop("value"),token:token},url:langUrl+"/support-spelling-mistake",cache:!1,beforeSend:function(){$("button[name=btn-spelling-mistake]").prop("disabled",!0)},success:function(data){$("#l-loading").hide(),"success"==data.status?($("#msg-spellingmistake-success").text(data.msg),$("#msg-spellingmistake-success").show(),$("#msg-spellingmistake-error").hide(),res(!0)):($("#msg-spellingmistake-error").text(data.msg),$("#msg-spellingmistake-error").show(),$("#msg-spellingmistake-success").hide(),rej(!1)),changetextafteravarible.prop("disabled",!1)},error:function(e){console.log(e)}})})};function getSelected(){if(window.getSelection)return window.getSelection();if(document.getSelection)return document.getSelection();var selection=document.selection&&document.selection.createRange();return!!selection.text&&selection.text}var selectedtextbeforavarible=$("#selectedtextbefore"),selectedtextbeforavaribleError=$("#selectedtextbefore_msg"),changetextafteravarible=$("#changetextafter"),changetextafteravaribleError=$("#changetextafter_msg"),selectionImage;$("#formspellingmistake").submit((async function(event){if(event.preventDefault(),valid=!0,selectedtextbeforavarible.prop("value").length<1?(selectedtextbeforavaribleError.text(txtEnterErrorContent),selectedtextbeforavarible.focus(),valid=!1):selectedtextbeforavaribleError.text(""),changetextafteravarible.prop("value").length<1?(changetextafteravaribleError.text(txtEnterErrorContentToEdit),changetextafteravarible.focus(),valid=!1):changetextafteravaribleError.text(""),valid)if("true"!==isAuth){let fullUrlPre=requestUrl.substring(baseUrl.length),fullurlpre=fullUrlPre.length>0?fullUrlPre:"/";$.ajax({method:"POST",dataType:"json",data:{selectedtextbeforavarible:selectedtextbeforavarible.prop("value"),changetextafteravarible:changetextafteravarible.prop("value"),fullurlpre:fullurlpre},url:langUrl+"/save-session-spelling-mistake",cache:!1,beforeSend:function(){$("#l-loading").show(),$("button[name=btn-spelling-mistake]").prop("disabled",!0)},success:function(data){$("#l-loading").hide(),window.location.href=langUrl+"/login"},error:function(e){}})}else if(changetextafteravarible.prop("disabled",!0),$("#l-loading").show(),captchaIsLoad){const token=await excuteCaptcha(captchaSiteKey);await submitSpellingMistake(token),$(this).prop("disabled",!1)}else{const success=await loadScript(captchaSrc);success&&setTimeout(async()=>{const token=await excuteCaptcha(captchaSiteKey);captchaIsLoad=""!==token,await submitSpellingMistake(token),$(this).prop("disabled",!1)},3500)}else event.preventDefault();return!1})),$(document).mouseup((function(e){var selectionText="",selection=getSelected();selectionImage||(selectionImage=$('<button class="btn-check" data-toggle="modal" data-target="#spelling-mistake-modal">').attr({type:"button",title:btnSpellingMistake,id:"quote-place"}).html(btnSpellingMistake).hide(),$(document.body).append(selectionImage)),$("#quote-place").click((function quote(){if(window.getSelection)selectionText=window.getSelection();else if(document.getSelection)selectionText=document.getSelection();else{if(!document.selection)return;selectionText=document.selection.createRange().text}document.formspellingmistake.selectedtextbefore.value=selectionText})).mousedown((function(){selectionImage&&selectionImage.fadeOut()})),selection&&(selection.toString().length>0?selectionImage.css({top:e.pageY+10,left:e.pageX-100}).fadeIn():selectionImage.fadeOut())})),$("#spelling-mistake-modal").on("hidden.bs.modal",(function(){location.reload()}))}));